import { Callout } from "/src/components/callout";

# XRPL

Node setup guide for your XRP Ledger Testnet or Mainnet validator.

## Requirements

- [Set up your Amplifier verifier node](https://docs.axelar.dev/validator/amplifier/verifier-onboarding/)
- Recommended hardware requirements:
    * CPU: 3+ GHz 64-bit x86_64 processor with 8+ cores
    * Memory: 64 GB RAM
    * Disk: 50+ GB SSD/NVMe
- Ubuntu Linux 18.04+ (tested on 22.04) or Debian 10+
- [Official Documentation](https://xrpl.org/docs/infrastructure/installation)

<Callout emoji="ðŸ’¡">
  Note: Verifiers are expected to run at least two months worth of history on their nodes. Please make sure you configure your node to stores two months of history instead of the [default two hours](https://xrpl.org/docs/infrastructure/installation/capacity-planning#disk-space).
</Callout>

## Install on Ubuntu or Debian Linux

1. Update repositories:

```bash
sudo apt -y update
sudo apt -y install apt-transport-https ca-certificates wget gnupg
```

2. Add Ripple's package-signing GPG key to your list of trusted keys:

```bash
sudo install -m 0755 -d /etc/apt/keyrings && \
    wget -qO- https://repos.ripple.com/repos/api/gpg/key/public | \
    sudo gpg --dearmor -o /etc/apt/keyrings/ripple.gpg
```

3. Check the fingerprint of the newly-added key:

```bash
gpg --show-keys /etc/apt/keyrings/ripple.gpg
```

The output should include an entry for Ripple such as the following:

```
pub   rsa3072 2019-02-14 [SC] [expires: 2026-02-17]
    C0010EC205B35A3310DC90DE395F97FFCCAFD9A2
uid           TechOps Team at Ripple <techops+rippled@ripple.com>
sub   rsa3072 2019-02-14 [E] [expires: 2026-02-17]
```

4. Add the appropriate Ripple repository for your operating system version. Replace `$OS` with:
- `buster` for Debian 10 Buster
- `bullseye` for Debian 11 Bullseye
- `bookworm` for Debian 12 Bookworm
- `bionic` for Ubuntu 18.04 Bionic Beaver
- `jammy` for Ubuntu 22.04 Jammy Jellyfish
- `noble` for Ubuntu 24.04 Noble Numbat

```bash
echo "deb [signed-by=/etc/apt/keyrings/ripple.gpg] https://repos.ripple.com/repos/rippled-deb $OS stable" | \
    sudo tee -a /etc/apt/sources.list.d/ripple.list
```

5. Update the package index to include Ripple's repo and install `rippled`.

```bash
sudo apt -y update && sudo apt -y install rippled
```

6. Check the status of the `rippled` service:

```bash
sudo systemctl status rippled.service
```

The `rippled` service should start automatically. If not, you can start it manually with:

```bash
sudo systemctl start rippled.service
```

If you're configuring a Mainnet `rippled` node, you can skip the next section.

## Just for Testnet

If you are setting up a Testnet `rippled` node, first complete the above proccess, and then follow these next steps:

### 1. Hub configuration

Edit your `rippled.cfg` file located under `/etc/opt/ripple/rippled.cfg`.

1. Set an `[ips]` stanza with the Testnet hub:

```
[ips]
s.altnet.rippletest.net 51235
```

2. Comment out the previous `[ips]` stanza, if there is one.

3. Add a `[network_id]` stanza with the appropriate value:

```
[network_id]
testnet
```

### 2. Trusted validator configuration

Edit your `validators.txt` file located under `/etc/opt/ripple/validators.txt`.

1. Uncomment or add the Testnet `[validator_list_sites]` and `[validator_list_keys]` stanzas:

```
[validator_list_sites]
https://vl.altnet.rippletest.net

[validator_list_keys]
ED264807102805220DA0F312E71FC2C69E1552C9C5790F6C25E3729DEB573D5860
```

2. Comment out any previous `[validator_list_sites]`, `[validator_list_keys]`, or `[validators]` stanzas.

### 3. Restart the server

```bash
sudo systemctl restart rippled
```

You can find more information on connecting to parallel networks [here](https://xrpl.org/docs/infrastructure/configuration/connect-your-rippled-to-the-xrp-test-net).

## Final checks

Use the `rippled` commandline interface to see if your server is synced with the network:

```bash
rippled server_info
```

It can take several minutes to sync. When the `server_state` in the response is `full`, then your server is fully synced with the network.

You can query the node with:

```bash
curl -H 'Content-Type: application/json' -d '{"method":"server_info","params":[{}]}' http://localhost:5005
```

## Recovering From Crashes

Due to ongoing changes in the Cosmos SDK your Axelar node may run into issues when running (such as an `AppHash` error). An example of such an error may appear as follows:

```text
ERR prevote step: ProposalBlock is invalid err="wrong Block.Header.AppHash.  Expected E2B04C0FA0076BC6805192AE9659042A665B54BFB473ADE522AF582A37C847BF, got E722AD45CBD7060AC9A8A95C936113CC05BBFDC90B0091A3FBE6D0E7F7D9C93A" height=18796195 module=consensus round=0


ERR CONSENSUS FAILURE!!! err="precommit step; +2/3 prevoted for an invalid block: wrong Block.Header.AppHash.  Expected E2B04C0FA0076BC6805192AE9659042A665B54BFB473ADE522AF582A37C847BF, got E722AD45CBD7060AC9A8A95C936113CC05BBFDC90B0091A3FBE6D0E7F7D9C93A" module=consensus stack="goroutine 136 [running]:\nruntime/debug.Stack()\n\truntime/debug/stack.go:26 +0x5e\ngithub.com/tendermint/tendermint/consensus.(*State).receiveRoutine.func2()\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:733 +0x46\npanic({0x1e76140?, 0xc12abd6260?})\n\truntime/panic.go:785 +0x132\ngithub.com/tendermint/tendermint/consensus.(*State).enterPrecommit(0xc000399508, 0x11ecea3, 0x0)\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:1421 +0x1599\ngithub.com/tendermint/tendermint/consensus.(*State).addVote(0xc000399508, 0xc02bd4fa40, {0xc00d5fe120, 0x28})\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:2153 +0x126f\ngithub.com/tendermint/tendermint/consensus.(*State).tryAddVote(0xc000399508, 0xc02bd4fa40, {0xc00d5fe120?, 0x0?})\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:1979 +0x26\ngithub.com/tendermint/tendermint/consensus.(*State).handleMsg(0xc000399508, {{0x30a1c60, 0xc1188c2998}, {0xc00d5fe120, 0x28}})\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:862 +0x15b\ngithub.com/tendermint/tendermint/consensus.(*State).receiveRoutine(0xc000399508, 0x0)\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:769 +0x3f1\ncreated by github.com/tendermint/tendermint/consensus.(*State).OnStart in goroutine 102\n\tgithub.com/tendermint/tendermint@v0.34.27/consensus/state.go:380 +0x10c\n"
```

If this error appears and your Axelar node crashes as result, then the node orchestration should perform a `rollback` on crash **before restarting the Axelar node** to auto-recover from such errors. The rollback can be performed by running:

```bash
axelard rollback
```


### Ampd Configuration
Once your node is up and running, you need to add the `XRPL` chain to your [ampd daemon's](https://github.com/axelarnetwork/axelar-amplifier/tree/main/ampd) `config.toml`file. This can be done by adding in the following configuration:

<tabs>
  <tab-item title="Mainnet">
    ```toml
    [[handlers]]
    type="XRPLMsgVerifier"
    chain_name="xrpl"
    chain_rpc_url="your_own_rpc"
    cosmwasm_contract="axelar1lppu77d7h4u7jylw9afctsc2908ea0eh3q6ap82fep5s2qjk9axqvd3sjx"

    [[handlers]]
    type="XRPLMultisigSigner"
    multisig_contract="axelar14a4ar5jh7ue4wg28jwsspf23r8k68j7g5d6d3fsttrhp42ajn4xq6zayy5"
    multisig_prover_contract="axelar12k57j826jl8xldyl2hf9hnc9gwf72zl48xfq4qn20sl4kl8unrxsejqvm8"
    ```
  </tab-item>
  <tab-item title="Testnet">
    ```toml
    [[handlers]]
    type="XRPLMsgVerifier"
    chain_name="xrpl"
    chain_rpc_url="your_own_rpc"
    cosmwasm_contract="axelar1pnynr6wnmchutkv6490mdqqxkz54fnrtmq8krqhvglhsqhmu7wzsnc86sy"

    [[handlers]]
    type="XRPLMultisigSigner"
    multisig_contract="axelar14a4ar5jh7ue4wg28jwsspf23r8k68j7g5d6d3fsttrhp42ajn4xq6zayy5"
    multisig_prover_contract="axelar1k82qfzu3l6rvc7twlp9lpwsnav507czl6xyrk0xv287t4439ymvsl6n470"
    ```
  </tab-item>
</tabs>




<Callout emoji="ðŸ’¡">
  Mainnet config instructions will be added when XRPL is integrated on mainnet.
</Callout>

### Register Chain 
For your node to be recognized by the Axelar network, you need to register your chain with the `ampd` daemon. This can be done by running:  

```bash
ampd register-chain-support amplifier xrpl
```

